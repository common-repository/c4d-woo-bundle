!function(C){"use strict";var x={symbol:"$",EventItemChange:function(){C("body").on("change",'.c4d-woo-bundle-item input[name*="mustby"], .c4d-woo-bundle-item .item-qty .qty, .c4d-woo-bundle-item .item-variations select',function(t,e){setTimeout(function(){x.updatePrice()},200)})},qty:function(){C("body").on("click",".c4d-woo-bundle-item .item-qty span",function(t){var e=C(this).parent().find("input.qty"),i=parseInt(e.val());return C(this).hasClass("next")?e.val(i+1):1<i&&e.val(i-1),x.updatePrice(),!1})},bundleQty:function(){C("body").on("click",".c4d-woo-bundle-buttons .qty-button span",function(t){var e=C(this).parent().find("input.qty"),i=parseInt(e.val());return C(this).hasClass("next")?e.val(i+1):1<i&&e.val(i-1),!1})},updatePrice:function(){C(".c4d-woo-bundle-wrap").each(function(t,e){var i,n=C(this).find(".c4d-woo-bundle-total"),o=C(this).data("options"),h=C(this).data("wc_setting"),_=(n.data("price"),""!=o.items.bundle_price?parseFloat(o.items.bundle_price):""),a=""!=o.items.discount?o.items.discount.split(","):[],y=""!=o.items.discount_type?o.items.discount_type:C(this).data("discount-type-global"),b=o.items.discount_bundle_only?o.items.discount_bundle_only:0,r=o.items.discount_user_type?o.items.discount_user_type:"percent",c=o.user_role?o.user_role:"guest",d=o.items["role_"+c],f=""!=o.items.position?o.items.position:"outside",s=0,v=0,u="",l="",p=0,w=""==_?0:_,g=0,q="right_space"==h.currency_pos?" ":"";i=C(this).find('.c4d-woo-bundle-item input[name*="mustby"]:checked').length-1,0<a.length&&0<i&&(v=i>a.length?a[a.length-1]:a[i-1],v=Number(v)),"user_role"==y&&(v=d,y=r),C(this).find(".c4d-woo-bundle-item .item").each(function(t,e){var i=parseFloat(C(e).data("price")),n=0<C(this).find(".item-qty input.qty").val()?parseFloat(C(this).find(".item-qty input.qty").val()):1,o="",a=C(this).find(".item-price"),r=a.data("set_price"),c=a.find(".c4d-woo-item-price-discount").remove(),d=(a.find(".c4d-woo-item-price-percent").remove(),c=0==a.find(".c4d-woo-item-price-original").length?'<span class="c4d-woo-item-price-original">'+a.html()+"</span>":a.html(),C(this).find(".item-variations").data("variations")),s=C(this).find(".item-variations select"),u=0,l=[];if(C(this).find(".item-qty-only").html(n),d&&"object"==typeof d){C.each(d,function(o,a){l[o]=0,s.each(function(t,e){var i=C(this).val(),n=C(this).data("attribute");void 0===a.attributes["attribute_"+n]||a.attributes["attribute_"+n]!=i&&""!=a.attributes["attribute_"+n]||(l[o]+=1),void 0!==a.attributes["attribute_"+n]&&a.attributes["attribute_"+n]!=i&&(l[o]-=1)})});var p=d[l.indexOf(Math.max.apply(Math,l))];0==r&&(i=p.display_price),u=p.variation_id}if(0<C(this).find('input[name*="mustby"]:checked').length&&""==_&&(0==t?"outside"==f&&(w+=i*n):g+=i*n),"percent"==y)m=(m=i-i*v/100).toFixed(2);else if("price"==y)var m=i.toFixed(2);o='<span class="c4d-woo-item-price-discount"><span class="woocommerce-Price-amount amount">',"right"==h.currency_pos||"right_space"==h.currency_pos?o+=m+q+'<span class="woocommerce-Price-currencySymbol">'+x.symbol+"</span>":o+='<span class="woocommerce-Price-currencySymbol">'+x.symbol+"</span>"+q+m,o+="</span></span>",0==t&&"1"==b||("percent"==y?a.html(o+c+'<span class="c4d-woo-item-price-percent">-'+("string"==typeof v?v.trim():v)+"%</span>"):"price"==y&&a.html(o+c)),C(this).attr("data-data",JSON.stringify({pid:C(this).attr("data-id"),price:i,discount:m,total:m*n,qty:n,variation:u,percent:v,percent_type:y,discount_bundle_only:b}))}),"right"==h.currency_pos||"right_space"==h.currency_pos?n.find(".total-price").html(w+g+q+x.symbol):n.find(".total-price").html(x.symbol+q+(w+g)),"percent"==y?(u="%",s="1"==b?w+g-g*v/100:(p=w+g)-p*v/100):(l=x.symbol,s=(p=w+g)-v),s=s.toFixed(2),"right"==h.currency_pos||"right_space"==h.currency_pos?n.find(".total-discount").html(s+q+x.symbol):n.find(".total-discount").html(x.symbol+q+s),0<v?(C(this).removeClass("discount-0-percent"),n.find(".total-save-number").html(" "+l+v+u)):C(this).addClass("discount-0-percent")})},addToCart:function(){C("body").on("click",".c4d-woo-bundle-add-to-cart",function(t){t.preventDefault();var i=C(this),e=i.parents(".c4d-woo-bundle-wrap"),n=e.data("options"),o=""!=n.items.bundle_price?parseFloat(n.items.bundle_price):"",a=e.find(".c4d-woo-bundle-buttons input.qty").val(),r=e.find(".c4d-woo-bundle-item .item"),c=r[0],d={product_id:0,variation_id:0,quantity:1,bundle_quantity:a,variations:[],discount_bundle_only:0,discount:e.find(".c4d-woo-bundle-total .total-discount").text(),price:e.find(".c4d-woo-bundle-total .total-price").text(),items:[]},s=C.parseJSON(C(c).attr("data-data"));return d.product_id=s.pid,d.variation_id=void 0!==s.variation?s.variation:0,d.main_product=s,d.quantity=s.qty,d.percent=s.percent,d.percent_type=s.percent_type,d.discount_bundle_only=s.discount_bundle_only,d.bundle_price=o,C(c).find(".item-variation").each(function(t,e){d.variations.push({name:"attribute_"+C(this).attr("data-attribute"),value:C(this).val()})}),r=r.slice(1),C.each(r,function(t,e){0<C(this).find('input[name*="mustby"]:checked').length&&d.items.push(C.parseJSON(C(this).attr("data-data")))}),i.addClass("loading"),C.ajax({type:"POST",url:woocommerce_params.ajax_url,data:{action:"c4d_woo_bundle_add_to_cart",datas:d},complete:function(t){if(i.removeClass("loading"),void 0!==t.responseJSON.fragments){var e=C(".widget_shopping_cart");e.find(".widget_shopping_cart_content").remove(),e.append(t.responseJSON.fragments["div.widget_shopping_cart_content"]),C(".c4d-woo-bundle-view-cart").addClass("active"),C(document.body).trigger("added_to_cart")}void 0!==t.responseJSON.error&&(window.location.href=t.responseJSON.product_url)}}),!1})},reorderBundleInCartAndCheckoutView:function(){C(".woocommerce-cart-form .c4d-woo-bundle-cart-wrap, .woocommerce-checkout-review-order .c4d-woo-bundle-cart-wrap").each(function(){var t=C(this).parent(),e=C(this).clone().addClass("active");C(this).remove(),t.append(e)})}};C(document).ready(function(){x.symbol=C(".woocommerce-Price-currencySymbol:first").html(),x.updatePrice(),x.qty(),x.bundleQty(),x.EventItemChange(),x.addToCart(),x.reorderBundleInCartAndCheckoutView(),C(document).ajaxComplete(function(t,e,i){void 0!==i.url&&void 0!==i.data&&(-1<i.url.indexOf("cart")&&-1<i.data.indexOf("update_cart")||-1<i.url.indexOf("update_order_review"))&&x.reorderBundleInCartAndCheckoutView()})})}(jQuery);